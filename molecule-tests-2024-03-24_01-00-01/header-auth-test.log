rolebinding.rbac.authorization.k8s.io/openid-rolebinding-istio-system created
/bin/bash: line 1: go: command not found
Pulling down latest helm-charts from remote repo to here: /home/jmazzite/source/kiali/helm-charts
Git repo for the helm charts is found here: /home/jmazzite/source/kiali/helm-charts
make[1]: Entering directory '/home/jmazzite/source/kiali/helm-charts'
Will use this helm executable: /home/jmazzite/source/kiali/helm-charts/_output/helm-install/helm
Building Helm Chart for Kiali operator
==> Linting /home/jmazzite/source/kiali/helm-charts/_output/charts/kiali-operator

1 chart(s) linted, 0 chart(s) failed
Successfully packaged chart and saved it to: /home/jmazzite/source/kiali/helm-charts/_output/charts/kiali-operator-1.82.0-SNAPSHOT.tgz
make[1]: Leaving directory '/home/jmazzite/source/kiali/helm-charts'
Minikube repos: external=[192.168.39.241:5000] internal=[localhost:5000]
| registry                    | ci      | enabled âœ…   | minikube                       |
Will not auto-detect any hosts for non-OpenShift clusters.
Will not rebuild kiali-molecule image.
podman volume exists molecule-tests-volume && echo "Podman volume already exists; deleting it" && podman volume rm molecule-tests-volume || true
podman volume create molecule-tests-volume
molecule-tests-volume
podman create -v molecule-tests-volume:/data --name molecule-volume-helper docker.io/busybox true
7d427c1fbbcab393fe58a61f7e1f9d03ba81a87eeaf36f9d12e64958020be42f
podman cp "/home/jmazzite/source/kiali/helm-charts" molecule-volume-helper:/data/helm-charts-repo
podman cp "/home/jmazzite/source/kiali/kiali/operator/" molecule-volume-helper:/data/operator
podman cp "/home/jmazzite/.kube/config" molecule-volume-helper:/data/kubeconfig
podman rm molecule-volume-helper
molecule-volume-helper
for msn in header-auth-test; do podman run --rm  --env KUBECONFIG="/tmp/molecule/kubeconfig" --env K8S_AUTH_KUBECONFIG="/tmp/molecule/kubeconfig" --env MOLECULE_CLUSTER_TYPE="minikube" --env MOLECULE_HELM_CHARTS_REPO=/tmp/molecule/helm-charts-repo -v molecule-tests-volume:/tmp/molecule -v /home/jmazzite/.minikube/certs/ca.pem:/home/jmazzite/.minikube/certs/ca.pem:Z -v /home/jmazzite/.minikube/certs/ca-key.pem:/home/jmazzite/.minikube/certs/ca-key.pem:Z -v /home/jmazzite/.minikube/certs/cert.pem:/home/jmazzite/.minikube/certs/cert.pem:Z -v /home/jmazzite/.minikube/certs/key.pem:/home/jmazzite/.minikube/certs/key.pem:Z -v /home/jmazzite/.minikube/machines/server.pem:/home/jmazzite/.minikube/machines/server.pem:Z -v /home/jmazzite/.minikube/machines/server-key.pem:/home/jmazzite/.minikube/machines/server-key.pem:Z -v /home/jmazzite/.minikube/machines/ci/id_rsa:/home/jmazzite/.minikube/machines/ci/id_rsa:Z -v /home/jmazzite/.minikube/machines/ci/id_rsa.pub:/home/jmazzite/.minikube/machines/ci/id_rsa.pub:Z -v /home/jmazzite/.minikube/machines/ci/config.json:/home/jmazzite/.minikube/machines/ci/config.json:Z -v /home/jmazzite/.minikube/cache/preloaded-tarball/preloaded-images-k8s-v18-v1.27.3-docker-overlay2-amd64.tar.lz4:/home/jmazzite/.minikube/cache/preloaded-tarball/preloaded-images-k8s-v18-v1.27.3-docker-overlay2-amd64.tar.lz4:Z -v /home/jmazzite/.minikube/cache/preloaded-tarball/preloaded-images-k8s-v18-v1.27.3-docker-overlay2-amd64.tar.lz4.checksum:/home/jmazzite/.minikube/cache/preloaded-tarball/preloaded-images-k8s-v18-v1.27.3-docker-overlay2-amd64.tar.lz4.checksum:Z -v /home/jmazzite/.minikube/cache/linux/amd64/v1.27.3/kubectl:/home/jmazzite/.minikube/cache/linux/amd64/v1.27.3/kubectl:Z -v /home/jmazzite/.minikube/config/config.json:/home/jmazzite/.minikube/config/config.json:Z -v /home/jmazzite/.minikube/logs/audit.json:/home/jmazzite/.minikube/logs/audit.json:Z -v /home/jmazzite/.minikube/logs/lastStart.txt:/home/jmazzite/.minikube/logs/lastStart.txt:Z -v /home/jmazzite/.minikube/profiles/ci/events.json:/home/jmazzite/.minikube/profiles/ci/events.json:Z -v /home/jmazzite/.minikube/profiles/ci/client.crt:/home/jmazzite/.minikube/profiles/ci/client.crt:Z -v /home/jmazzite/.minikube/profiles/ci/client.key:/home/jmazzite/.minikube/profiles/ci/client.key:Z -v /home/jmazzite/.minikube/profiles/ci/apiserver.crt.32a60d1a:/home/jmazzite/.minikube/profiles/ci/apiserver.crt.32a60d1a:Z -v /home/jmazzite/.minikube/profiles/ci/apiserver.key.32a60d1a:/home/jmazzite/.minikube/profiles/ci/apiserver.key.32a60d1a:Z -v /home/jmazzite/.minikube/profiles/ci/apiserver.crt:/home/jmazzite/.minikube/profiles/ci/apiserver.crt:Z -v /home/jmazzite/.minikube/profiles/ci/apiserver.key:/home/jmazzite/.minikube/profiles/ci/apiserver.key:Z -v /home/jmazzite/.minikube/profiles/ci/proxy-client.crt:/home/jmazzite/.minikube/profiles/ci/proxy-client.crt:Z -v /home/jmazzite/.minikube/profiles/ci/proxy-client.key:/home/jmazzite/.minikube/profiles/ci/proxy-client.key:Z -v /home/jmazzite/.minikube/profiles/ci/config.json:/home/jmazzite/.minikube/profiles/ci/config.json:Z -v /home/jmazzite/.minikube/last_update_check:/home/jmazzite/.minikube/last_update_check:Z -v /home/jmazzite/.minikube/bin/docker-machine-driver-kvm2:/home/jmazzite/.minikube/bin/docker-machine-driver-kvm2:Z -v /home/jmazzite/.minikube/ca.crt:/home/jmazzite/.minikube/ca.crt:Z -v /home/jmazzite/.minikube/ca.key:/home/jmazzite/.minikube/ca.key:Z -v /home/jmazzite/.minikube/proxy-client-ca.crt:/home/jmazzite/.minikube/proxy-client-ca.crt:Z -v /home/jmazzite/.minikube/proxy-client-ca.key:/home/jmazzite/.minikube/proxy-client-ca.key:Z -v /home/jmazzite/.minikube/cert.pem:/home/jmazzite/.minikube/cert.pem:Z -v /home/jmazzite/.minikube/key.pem:/home/jmazzite/.minikube/key.pem:Z -v /home/jmazzite/.minikube/ca.pem:/home/jmazzite/.minikube/ca.pem:Z --env MOLECULE_MINIKUBE_IP=192.168.39.241  -w /tmp/molecule/operator --network="host"  --add-host="api.crc.testing:192.168.130.11" --add-host="kiali-istio-system.apps-crc.testing:192.168.130.11" --add-host="prometheus-istio-system.apps-crc.testing:192.168.130.11" --env DORP=podman --env OPERATOR_IMAGE_PULL_SECRET_NAME= --env MOLECULE_KIALI_CR_SPEC_VERSION=default --env PLUGIN_IMAGE_PULL_SECRET_JSON="" --env MOLECULE_OSSMCONSOLE_CR_SPEC_VERSION="default"  --env MOLECULE_OPERATOR_PROFILER_ENABLED=true --env MOLECULE_OPERATOR_INSTALLER=helm --env MOLECULE_DUMP_LOGS_ON_ERROR=true  --env MOLECULE_WAIT_RETRIES=120 localhost/kiali-molecule:latest molecule --debug test  --scenario-name ${msn}; if [ "$?" != "0" ]; then echo "Molecule test failed: ${msn}"; podman volume rm molecule-tests-volume; exit 1; fi; done
DEBUG    Validating schema /tmp/molecule/operator/molecule/header-auth-test/molecule.yml.
WARNING  Driver podman does not provide a schema.
INFO     header-auth-test scenario test matrix: prepare, converge, destroy
INFO     Performing prerun with role_name_check=0...
INFO     Running ansible-galaxy collection install -v -r requirements.yml
INFO     Set ANSIBLE_ROLES_PATH=roles:/home/runner/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles
INFO     Running header-auth-test > prepare
INFO     Sanity checks: 'podman'
DEBUG: ANSIBLE ENVIRONMENT:
ANSIBLE_COLLECTIONS_PATH: /home/runner/.cache/molecule/operator/header-auth-test/collections:/home/runner/.ansible/collections:/usr/share/ansible/collections:/etc/ansible/collections
ANSIBLE_CONFIG: /home/runner/.cache/molecule/operator/header-auth-test/ansible.cfg
ANSIBLE_FILTER_PLUGINS: /usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/filter:/home/runner/.cache/molecule/operator/header-auth-test/plugins/filter:/tmp/molecule/operator/plugins/filter:/home/runner/.ansible/plugins/filter:/usr/share/ansible/plugins/filter
ANSIBLE_LIBRARY: /usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/modules:/usr/local/lib/python3.11/site-packages/molecule_plugins/vagrant/modules:/home/runner/.cache/molecule/operator/header-auth-test/library:/tmp/molecule/operator/library:/home/runner/.ansible/plugins/modules:/usr/share/ansible/plugins/modules
ANSIBLE_ROLES_PATH: /home/runner/.cache/molecule/operator/header-auth-test/roles:/tmp/molecule:/home/runner/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles

DEBUG: MOLECULE ENVIRONMENT:
MOLECULE_CLUSTER_TYPE: minikube
MOLECULE_DEBUG: 'True'
MOLECULE_DEPENDENCY_NAME: galaxy
MOLECULE_DRIVER_NAME: podman
MOLECULE_DUMP_LOGS_ON_ERROR: 'true'
MOLECULE_ENV_FILE: /tmp/molecule/operator/.env.yml
MOLECULE_EPHEMERAL_DIRECTORY: /home/runner/.cache/molecule/operator/header-auth-test
MOLECULE_FILE: /home/runner/.cache/molecule/operator/header-auth-test/molecule.yml
MOLECULE_HELM_CHARTS_REPO: /tmp/molecule/helm-charts-repo
MOLECULE_INSTANCE_CONFIG: /home/runner/.cache/molecule/operator/header-auth-test/instance_config.yml
MOLECULE_INVENTORY_FILE: /home/runner/.cache/molecule/operator/header-auth-test/inventory/ansible_inventory.yml
MOLECULE_KIALI_CR_SPEC_VERSION: default
MOLECULE_MINIKUBE_IP: 192.168.39.241
MOLECULE_OPERATOR_INSTALLER: helm
MOLECULE_OPERATOR_PROFILER_ENABLED: 'true'
MOLECULE_OSSMCONSOLE_CR_SPEC_VERSION: default
MOLECULE_PROJECT_DIRECTORY: /tmp/molecule/operator
MOLECULE_PROVISIONER_NAME: ansible
MOLECULE_SCENARIO_DIRECTORY: /tmp/molecule/operator/molecule/header-auth-test
MOLECULE_SCENARIO_NAME: header-auth-test
MOLECULE_STATE_FILE: /home/runner/.cache/molecule/operator/header-auth-test/state.yml
MOLECULE_VERIFIER_NAME: ansible
MOLECULE_VERIFIER_TEST_DIRECTORY: /tmp/molecule/operator/molecule/header-auth-test/tests
MOLECULE_WAIT_RETRIES: '120'

DEBUG: SHELL REPLAY:
ANSIBLE_COLLECTIONS_PATH=/home/runner/.cache/molecule/operator/header-auth-test/collections:/home/runner/.ansible/collections:/usr/share/ansible/collections:/etc/ansible/collections ANSIBLE_CONFIG=/home/runner/.cache/molecule/operator/header-auth-test/ansible.cfg ANSIBLE_FILTER_PLUGINS=/usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/filter:/home/runner/.cache/molecule/operator/header-auth-test/plugins/filter:/tmp/molecule/operator/plugins/filter:/home/runner/.ansible/plugins/filter:/usr/share/ansible/plugins/filter ANSIBLE_LIBRARY=/usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/modules:/usr/local/lib/python3.11/site-packages/molecule_plugins/vagrant/modules:/home/runner/.cache/molecule/operator/header-auth-test/library:/tmp/molecule/operator/library:/home/runner/.ansible/plugins/modules:/usr/share/ansible/plugins/modules ANSIBLE_ROLES_PATH=/home/runner/.cache/molecule/operator/header-auth-test/roles:/tmp/molecule:/home/runner/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles MOLECULE_CLUSTER_TYPE=minikube MOLECULE_DEBUG=True MOLECULE_DEPENDENCY_NAME=galaxy MOLECULE_DRIVER_NAME=podman MOLECULE_DUMP_LOGS_ON_ERROR=true MOLECULE_ENV_FILE=/tmp/molecule/operator/.env.yml MOLECULE_EPHEMERAL_DIRECTORY=/home/runner/.cache/molecule/operator/header-auth-test MOLECULE_FILE=/home/runner/.cache/molecule/operator/header-auth-test/molecule.yml MOLECULE_HELM_CHARTS_REPO=/tmp/molecule/helm-charts-repo MOLECULE_INSTANCE_CONFIG=/home/runner/.cache/molecule/operator/header-auth-test/instance_config.yml MOLECULE_INVENTORY_FILE=/home/runner/.cache/molecule/operator/header-auth-test/inventory/ansible_inventory.yml MOLECULE_KIALI_CR_SPEC_VERSION=default MOLECULE_MINIKUBE_IP=192.168.39.241 MOLECULE_OPERATOR_INSTALLER=helm MOLECULE_OPERATOR_PROFILER_ENABLED=true MOLECULE_OSSMCONSOLE_CR_SPEC_VERSION=default MOLECULE_PROJECT_DIRECTORY=/tmp/molecule/operator MOLECULE_PROVISIONER_NAME=ansible MOLECULE_SCENARIO_DIRECTORY=/tmp/molecule/operator/molecule/header-auth-test MOLECULE_SCENARIO_NAME=header-auth-test MOLECULE_STATE_FILE=/home/runner/.cache/molecule/operator/header-auth-test/state.yml MOLECULE_VERIFIER_NAME=ansible MOLECULE_VERIFIER_TEST_DIRECTORY=/tmp/molecule/operator/molecule/header-auth-test/tests MOLECULE_WAIT_RETRIES=120


PLAY [Prepare] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Get information about the cluster] ***************************************
ok: [localhost]

TASK [Determine the cluster type] **********************************************
ok: [localhost]

TASK [Determine if the operator installation is managed externally or not] *****
ok: [localhost]

TASK [Make sure the operator namespace exists] *********************************
changed: [localhost]

TASK [Find the latest Operator Helm Chart] *************************************
changed: [localhost]

TASK [set_fact] ****************************************************************
ok: [localhost]

TASK [fail] ********************************************************************
skipping: [localhost]

TASK [Install Operator via Helm] ***********************************************
changed: [localhost]

TASK [Make sure the CR namespace exists] ***************************************
ok: [localhost]

TASK [Wait for the CRD to be established] **************************************
ok: [localhost]

TASK [Prepare initial Kiali CR definition based solely on the template] ********
ok: [localhost]

TASK [Create Kiali CR] *********************************************************
changed: [localhost]

TASK [Asserting that Kiali is Deployed] ****************************************
FAILED - RETRYING: [localhost]: Asserting that Kiali is Deployed (120 retries left).
FAILED - RETRYING: [localhost]: Asserting that Kiali is Deployed (119 retries left).
FAILED - RETRYING: [localhost]: Asserting that Kiali is Deployed (118 retries left).
FAILED - RETRYING: [localhost]: Asserting that Kiali is Deployed (117 retries left).
FAILED - RETRYING: [localhost]: Asserting that Kiali is Deployed (116 retries left).
FAILED - RETRYING: [localhost]: Asserting that Kiali is Deployed (115 retries left).
FAILED - RETRYING: [localhost]: Asserting that Kiali is Deployed (114 retries left).
ok: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=13   changed=4    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0

INFO     Running header-auth-test > converge
DEBUG: ANSIBLE ENVIRONMENT:
ANSIBLE_COLLECTIONS_PATH: /home/runner/.cache/molecule/operator/header-auth-test/collections:/home/runner/.ansible/collections:/usr/share/ansible/collections:/etc/ansible/collections
ANSIBLE_CONFIG: /home/runner/.cache/molecule/operator/header-auth-test/ansible.cfg
ANSIBLE_FILTER_PLUGINS: /usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/filter:/home/runner/.cache/molecule/operator/header-auth-test/plugins/filter:/tmp/molecule/operator/plugins/filter:/home/runner/.ansible/plugins/filter:/usr/share/ansible/plugins/filter
ANSIBLE_LIBRARY: /usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/modules:/usr/local/lib/python3.11/site-packages/molecule_plugins/vagrant/modules:/home/runner/.cache/molecule/operator/header-auth-test/library:/tmp/molecule/operator/library:/home/runner/.ansible/plugins/modules:/usr/share/ansible/plugins/modules
ANSIBLE_ROLES_PATH: /home/runner/.cache/molecule/operator/header-auth-test/roles:/tmp/molecule:/home/runner/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles

DEBUG: MOLECULE ENVIRONMENT:
MOLECULE_CLUSTER_TYPE: minikube
MOLECULE_DEBUG: 'True'
MOLECULE_DEPENDENCY_NAME: galaxy
MOLECULE_DRIVER_NAME: podman
MOLECULE_DUMP_LOGS_ON_ERROR: 'true'
MOLECULE_ENV_FILE: /tmp/molecule/operator/.env.yml
MOLECULE_EPHEMERAL_DIRECTORY: /home/runner/.cache/molecule/operator/header-auth-test
MOLECULE_FILE: /home/runner/.cache/molecule/operator/header-auth-test/molecule.yml
MOLECULE_HELM_CHARTS_REPO: /tmp/molecule/helm-charts-repo
MOLECULE_INSTANCE_CONFIG: /home/runner/.cache/molecule/operator/header-auth-test/instance_config.yml
MOLECULE_INVENTORY_FILE: /home/runner/.cache/molecule/operator/header-auth-test/inventory/ansible_inventory.yml
MOLECULE_KIALI_CR_SPEC_VERSION: default
MOLECULE_MINIKUBE_IP: 192.168.39.241
MOLECULE_OPERATOR_INSTALLER: helm
MOLECULE_OPERATOR_PROFILER_ENABLED: 'true'
MOLECULE_OSSMCONSOLE_CR_SPEC_VERSION: default
MOLECULE_PROJECT_DIRECTORY: /tmp/molecule/operator
MOLECULE_PROVISIONER_NAME: ansible
MOLECULE_SCENARIO_DIRECTORY: /tmp/molecule/operator/molecule/header-auth-test
MOLECULE_SCENARIO_NAME: header-auth-test
MOLECULE_STATE_FILE: /home/runner/.cache/molecule/operator/header-auth-test/state.yml
MOLECULE_VERIFIER_NAME: ansible
MOLECULE_VERIFIER_TEST_DIRECTORY: /tmp/molecule/operator/molecule/header-auth-test/tests
MOLECULE_WAIT_RETRIES: '120'

DEBUG: SHELL REPLAY:
ANSIBLE_COLLECTIONS_PATH=/home/runner/.cache/molecule/operator/header-auth-test/collections:/home/runner/.ansible/collections:/usr/share/ansible/collections:/etc/ansible/collections ANSIBLE_CONFIG=/home/runner/.cache/molecule/operator/header-auth-test/ansible.cfg ANSIBLE_FILTER_PLUGINS=/usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/filter:/home/runner/.cache/molecule/operator/header-auth-test/plugins/filter:/tmp/molecule/operator/plugins/filter:/home/runner/.ansible/plugins/filter:/usr/share/ansible/plugins/filter ANSIBLE_LIBRARY=/usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/modules:/usr/local/lib/python3.11/site-packages/molecule_plugins/vagrant/modules:/home/runner/.cache/molecule/operator/header-auth-test/library:/tmp/molecule/operator/library:/home/runner/.ansible/plugins/modules:/usr/share/ansible/plugins/modules ANSIBLE_ROLES_PATH=/home/runner/.cache/molecule/operator/header-auth-test/roles:/tmp/molecule:/home/runner/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles MOLECULE_CLUSTER_TYPE=minikube MOLECULE_DEBUG=True MOLECULE_DEPENDENCY_NAME=galaxy MOLECULE_DRIVER_NAME=podman MOLECULE_DUMP_LOGS_ON_ERROR=true MOLECULE_ENV_FILE=/tmp/molecule/operator/.env.yml MOLECULE_EPHEMERAL_DIRECTORY=/home/runner/.cache/molecule/operator/header-auth-test MOLECULE_FILE=/home/runner/.cache/molecule/operator/header-auth-test/molecule.yml MOLECULE_HELM_CHARTS_REPO=/tmp/molecule/helm-charts-repo MOLECULE_INSTANCE_CONFIG=/home/runner/.cache/molecule/operator/header-auth-test/instance_config.yml MOLECULE_INVENTORY_FILE=/home/runner/.cache/molecule/operator/header-auth-test/inventory/ansible_inventory.yml MOLECULE_KIALI_CR_SPEC_VERSION=default MOLECULE_MINIKUBE_IP=192.168.39.241 MOLECULE_OPERATOR_INSTALLER=helm MOLECULE_OPERATOR_PROFILER_ENABLED=true MOLECULE_OSSMCONSOLE_CR_SPEC_VERSION=default MOLECULE_PROJECT_DIRECTORY=/tmp/molecule/operator MOLECULE_PROVISIONER_NAME=ansible MOLECULE_SCENARIO_DIRECTORY=/tmp/molecule/operator/molecule/header-auth-test MOLECULE_SCENARIO_NAME=header-auth-test MOLECULE_STATE_FILE=/home/runner/.cache/molecule/operator/header-auth-test/state.yml MOLECULE_VERIFIER_NAME=ansible MOLECULE_VERIFIER_TEST_DIRECTORY=/tmp/molecule/operator/molecule/header-auth-test/tests MOLECULE_WAIT_RETRIES=120


PLAY [Tests] *******************************************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Get information about the cluster] ***************************************
ok: [localhost]

TASK [Determine the cluster type] **********************************************
ok: [localhost]

TASK [Get Kiali CR if present] *************************************************
ok: [localhost]

TASK [Get Kiali Operator Pod] **************************************************
ok: [localhost]

TASK [Get Kiali Pod] ***********************************************************
ok: [localhost]

TASK [Get Kiali Configmap] *****************************************************
ok: [localhost]

TASK [Format Configmap] ********************************************************
ok: [localhost]

TASK [Get Kiali Deployment] ****************************************************
ok: [localhost]

TASK [Get Kiali Service] *******************************************************
ok: [localhost]

TASK [Get Kiali Route] *********************************************************
skipping: [localhost]

TASK [Get Kiali Ingress] *******************************************************
ok: [localhost]

TASK [Determine the Kiali Route URL on OpenShift] ******************************
skipping: [localhost]

TASK [Determine the Kiali Ingress URL on minikube] *****************************
ok: [localhost]

TASK [Determine the Kiali Ingress URL on kind] *********************************
skipping: [localhost]

TASK [Assert Kiali Pod is Running and there is only one] ***********************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Assert Kiali Pod is Running on the correct Namespace] ********************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Asserting that Kiali Pod exists and there is only one] *******************
ok: [localhost]

TASK [Wait for Kiali to be running and accepting requests] *********************
ok: [localhost]

TASK [Make sure the test set the strategy to header] ***************************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Assert that we can access Kiali console login screen that does not need authentication] ***
ok: [localhost]

TASK [Try to access Kiali api endpoint that requires authentication (should return error - we did not login yet)] ***
ok: [localhost]

TASK [Step one - start] ********************************************************
ok: [localhost]

TASK [Assert step one] *********************************************************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [set_fact] ****************************************************************
ok: [localhost]

TASK [Step two - auth request] *************************************************
ok: [localhost]

TASK [Assert step two] *********************************************************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Step three - auth local request (strip some weirdness in the location URL)] ***
ok: [localhost]

TASK [Assert step three] *******************************************************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Step four - local login (strip some weirdness in the location URL)] ******
ok: [localhost]

TASK [Assert step four] ********************************************************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Step five - approval (strip some weirdness in the location URL)] *********
ok: [localhost]

TASK [Assert step five] ********************************************************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Step six - callback (strip some weirdness off the location - why is ansible doing that?)] ***
ok: [localhost]

TASK [Assert step six] *********************************************************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [set_fact] ****************************************************************
ok: [localhost]

TASK [Step seven - get bearer token] *******************************************
ok: [localhost]

TASK [Assert step seven] *******************************************************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [set_fact] ****************************************************************
ok: [localhost]

TASK [Make a request that requires authentication (should now return 200)] *****
ok: [localhost]

TASK [Assert that we were able to get the list of namespaces] ******************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

PLAY RECAP *********************************************************************
localhost                  : ok=38   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0

INFO     Running header-auth-test > destroy
DEBUG: ANSIBLE ENVIRONMENT:
ANSIBLE_COLLECTIONS_PATH: /home/runner/.cache/molecule/operator/header-auth-test/collections:/home/runner/.ansible/collections:/usr/share/ansible/collections:/etc/ansible/collections
ANSIBLE_CONFIG: /home/runner/.cache/molecule/operator/header-auth-test/ansible.cfg
ANSIBLE_FILTER_PLUGINS: /usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/filter:/home/runner/.cache/molecule/operator/header-auth-test/plugins/filter:/tmp/molecule/operator/plugins/filter:/home/runner/.ansible/plugins/filter:/usr/share/ansible/plugins/filter
ANSIBLE_LIBRARY: /usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/modules:/usr/local/lib/python3.11/site-packages/molecule_plugins/vagrant/modules:/home/runner/.cache/molecule/operator/header-auth-test/library:/tmp/molecule/operator/library:/home/runner/.ansible/plugins/modules:/usr/share/ansible/plugins/modules
ANSIBLE_ROLES_PATH: /home/runner/.cache/molecule/operator/header-auth-test/roles:/tmp/molecule:/home/runner/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles

DEBUG: MOLECULE ENVIRONMENT:
MOLECULE_CLUSTER_TYPE: minikube
MOLECULE_DEBUG: 'True'
MOLECULE_DEPENDENCY_NAME: galaxy
MOLECULE_DRIVER_NAME: podman
MOLECULE_DUMP_LOGS_ON_ERROR: 'true'
MOLECULE_ENV_FILE: /tmp/molecule/operator/.env.yml
MOLECULE_EPHEMERAL_DIRECTORY: /home/runner/.cache/molecule/operator/header-auth-test
MOLECULE_FILE: /home/runner/.cache/molecule/operator/header-auth-test/molecule.yml
MOLECULE_HELM_CHARTS_REPO: /tmp/molecule/helm-charts-repo
MOLECULE_INSTANCE_CONFIG: /home/runner/.cache/molecule/operator/header-auth-test/instance_config.yml
MOLECULE_INVENTORY_FILE: /home/runner/.cache/molecule/operator/header-auth-test/inventory/ansible_inventory.yml
MOLECULE_KIALI_CR_SPEC_VERSION: default
MOLECULE_MINIKUBE_IP: 192.168.39.241
MOLECULE_OPERATOR_INSTALLER: helm
MOLECULE_OPERATOR_PROFILER_ENABLED: 'true'
MOLECULE_OSSMCONSOLE_CR_SPEC_VERSION: default
MOLECULE_PROJECT_DIRECTORY: /tmp/molecule/operator
MOLECULE_PROVISIONER_NAME: ansible
MOLECULE_SCENARIO_DIRECTORY: /tmp/molecule/operator/molecule/header-auth-test
MOLECULE_SCENARIO_NAME: header-auth-test
MOLECULE_STATE_FILE: /home/runner/.cache/molecule/operator/header-auth-test/state.yml
MOLECULE_VERIFIER_NAME: ansible
MOLECULE_VERIFIER_TEST_DIRECTORY: /tmp/molecule/operator/molecule/header-auth-test/tests
MOLECULE_WAIT_RETRIES: '120'

DEBUG: SHELL REPLAY:
ANSIBLE_COLLECTIONS_PATH=/home/runner/.cache/molecule/operator/header-auth-test/collections:/home/runner/.ansible/collections:/usr/share/ansible/collections:/etc/ansible/collections ANSIBLE_CONFIG=/home/runner/.cache/molecule/operator/header-auth-test/ansible.cfg ANSIBLE_FILTER_PLUGINS=/usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/filter:/home/runner/.cache/molecule/operator/header-auth-test/plugins/filter:/tmp/molecule/operator/plugins/filter:/home/runner/.ansible/plugins/filter:/usr/share/ansible/plugins/filter ANSIBLE_LIBRARY=/usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/modules:/usr/local/lib/python3.11/site-packages/molecule_plugins/vagrant/modules:/home/runner/.cache/molecule/operator/header-auth-test/library:/tmp/molecule/operator/library:/home/runner/.ansible/plugins/modules:/usr/share/ansible/plugins/modules ANSIBLE_ROLES_PATH=/home/runner/.cache/molecule/operator/header-auth-test/roles:/tmp/molecule:/home/runner/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles MOLECULE_CLUSTER_TYPE=minikube MOLECULE_DEBUG=True MOLECULE_DEPENDENCY_NAME=galaxy MOLECULE_DRIVER_NAME=podman MOLECULE_DUMP_LOGS_ON_ERROR=true MOLECULE_ENV_FILE=/tmp/molecule/operator/.env.yml MOLECULE_EPHEMERAL_DIRECTORY=/home/runner/.cache/molecule/operator/header-auth-test MOLECULE_FILE=/home/runner/.cache/molecule/operator/header-auth-test/molecule.yml MOLECULE_HELM_CHARTS_REPO=/tmp/molecule/helm-charts-repo MOLECULE_INSTANCE_CONFIG=/home/runner/.cache/molecule/operator/header-auth-test/instance_config.yml MOLECULE_INVENTORY_FILE=/home/runner/.cache/molecule/operator/header-auth-test/inventory/ansible_inventory.yml MOLECULE_KIALI_CR_SPEC_VERSION=default MOLECULE_MINIKUBE_IP=192.168.39.241 MOLECULE_OPERATOR_INSTALLER=helm MOLECULE_OPERATOR_PROFILER_ENABLED=true MOLECULE_OSSMCONSOLE_CR_SPEC_VERSION=default MOLECULE_PROJECT_DIRECTORY=/tmp/molecule/operator MOLECULE_PROVISIONER_NAME=ansible MOLECULE_SCENARIO_DIRECTORY=/tmp/molecule/operator/molecule/header-auth-test MOLECULE_SCENARIO_NAME=header-auth-test MOLECULE_STATE_FILE=/home/runner/.cache/molecule/operator/header-auth-test/state.yml MOLECULE_VERIFIER_NAME=ansible MOLECULE_VERIFIER_TEST_DIRECTORY=/tmp/molecule/operator/molecule/header-auth-test/tests MOLECULE_WAIT_RETRIES=120


PLAY [Destroy] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Get information about the cluster] ***************************************
ok: [localhost]

TASK [Determine the cluster type] **********************************************
ok: [localhost]

TASK [Determine if the operator installation is managed externally or not] *****
ok: [localhost]

TASK [Remove Kiali CR] *********************************************************
changed: [localhost]

TASK [Wait for Kiali ConfigMap to be uninstalled] ******************************
ok: [localhost]

TASK [Uninstall Operator via Helm] *********************************************
changed: [localhost]

TASK [Remove CRDs] *************************************************************
changed: [localhost]

TASK [Removing Operator namespace] *********************************************
changed: [localhost]

TASK [Removing CR namespace if it is different than control plane and operator namespace] ***
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=9    changed=4    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0

INFO     Pruning extra files from scenario ephemeral directory
podman volume rm molecule-tests-volume
molecule-tests-volume
rolebinding.rbac.authorization.k8s.io "openid-rolebinding-istio-system" deleted
