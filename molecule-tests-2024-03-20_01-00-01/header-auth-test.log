rolebinding.rbac.authorization.k8s.io/openid-rolebinding-istio-system created
/bin/bash: line 1: go: command not found
Pulling down latest helm-charts from remote repo to here: /home/jmazzite/source/kiali/helm-charts
Git repo for the helm charts is found here: /home/jmazzite/source/kiali/helm-charts
make[1]: Entering directory '/home/jmazzite/source/kiali/helm-charts'
Will use this helm executable: /home/jmazzite/source/kiali/helm-charts/_output/helm-install/helm
Building Helm Chart for Kiali operator
==> Linting /home/jmazzite/source/kiali/helm-charts/_output/charts/kiali-operator

1 chart(s) linted, 0 chart(s) failed
Successfully packaged chart and saved it to: /home/jmazzite/source/kiali/helm-charts/_output/charts/kiali-operator-1.82.0-SNAPSHOT.tgz
make[1]: Leaving directory '/home/jmazzite/source/kiali/helm-charts'
Minikube repos: external=[192.168.39.60:5000] internal=[localhost:5000]
| registry                    | ci      | enabled ✅   | minikube                       |
Will not auto-detect any hosts for non-OpenShift clusters.
STEP 1/4: FROM quay.io/ansible/creator-ee:v0.20.0
Trying to pull quay.io/ansible/creator-ee:v0.20.0...
Getting image source signatures
Copying blob sha256:6a4437d12ad57e4e1800644fcd365f90940d37337e0c5f1ff5c1a1cb66ec1d10
Copying blob sha256:a05d6aa1ab744373a217fbf560eb78d7c1a6ebed34b9f7bde34b3a125ca8d6c0
Copying blob sha256:eaac7334e7ab0da453f26207ed7711b003721f19ca2d9f3b90bb350fcc8906fc
Copying blob sha256:e9438ddbcb809c83069f8e7f1e035acffc2fb11156305815e62173d7a7d5139a
Copying blob sha256:0afce06128075f0995856f99dcc05d94ba3810a2855c4b3f0d3fe789fcbeead5
Copying blob sha256:7b05cec1a1b51652574e23a83ffd672b36dfc85bb7ae1ec1da4b44e4c4c2e5c2
Copying blob sha256:90e5f6bd07c80fe1d5f42e3c848dd6d2b9ec8fd2548af8f2ff7f10fab3b8a3d1
Copying blob sha256:e194cc6358adf7907f3b6789ac6f8c1728cc648e549c88621a77679eae4ba1ca
Copying blob sha256:322be10184d066580bbf6d45dd78d2d14735a06a6ae772baf025f75f8ad6afcc
Copying blob sha256:b61759fbc1637caf62eb749f01a276b55158f7b1aa161adef8af7bd0b0e29c5d
Copying blob sha256:39b21c1fa8b39c4df8e2e01ea235b50f12264a28d98675f4727d5c1f704462d6
Copying blob sha256:09a131db2ab7ae11d5580e9205b0aef4efad0d443929db4c7e60d71f27a6d4df
Copying blob sha256:807c755306365fe855f0f38aa7deea1de2002c3b2224d280e1f20758599817e1
Copying config sha256:278a94cdb5159adf04f0da2d8c84a9fb3368fe368627806a5ac38e96810b7d45
Writing manifest to image destination
STEP 2/4: RUN pip install jmespath kubernetes
Requirement already satisfied: jmespath in /usr/local/lib/python3.11/site-packages (1.0.1)
Collecting kubernetes
  Downloading kubernetes-29.0.0-py2.py3-none-any.whl (1.6 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.6/1.6 MB 6.9 MB/s eta 0:00:00
Requirement already satisfied: certifi>=14.05.14 in /usr/local/lib/python3.11/site-packages (from kubernetes) (2023.7.22)
Requirement already satisfied: six>=1.9.0 in /usr/lib/python3.11/site-packages (from kubernetes) (1.16.0)
Collecting python-dateutil>=2.5.3
  Downloading python_dateutil-2.9.0.post0-py2.py3-none-any.whl (229 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 229.9/229.9 kB 11.4 MB/s eta 0:00:00
Requirement already satisfied: pyyaml>=5.4.1 in /usr/local/lib64/python3.11/site-packages (from kubernetes) (6.0.1)
Collecting google-auth>=1.0.1
  Downloading google_auth-2.28.2-py2.py3-none-any.whl (186 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 186.9/186.9 kB 11.6 MB/s eta 0:00:00
Collecting websocket-client!=0.40.0,!=0.41.*,!=0.42.*,>=0.32.0
  Downloading websocket_client-1.7.0-py3-none-any.whl (58 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 58.5/58.5 kB 13.1 MB/s eta 0:00:00
Requirement already satisfied: requests in /usr/local/lib/python3.11/site-packages (from kubernetes) (2.31.0)
Collecting requests-oauthlib
  Downloading requests_oauthlib-1.4.0-py2.py3-none-any.whl (24 kB)
Collecting oauthlib>=3.2.2
  Downloading oauthlib-3.2.2-py3-none-any.whl (151 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 151.7/151.7 kB 11.4 MB/s eta 0:00:00
Requirement already satisfied: urllib3>=1.24.2 in /usr/local/lib/python3.11/site-packages (from kubernetes) (2.0.4)
Collecting cachetools<6.0,>=2.0.0
  Downloading cachetools-5.3.3-py3-none-any.whl (9.3 kB)
Collecting pyasn1-modules>=0.2.1
  Downloading pyasn1_modules-0.3.0-py2.py3-none-any.whl (181 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 181.3/181.3 kB 11.2 MB/s eta 0:00:00
Collecting rsa<5,>=3.1.4
  Downloading rsa-4.9-py3-none-any.whl (34 kB)
Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib64/python3.11/site-packages (from requests->kubernetes) (3.2.0)
Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.11/site-packages (from requests->kubernetes) (3.4)
Collecting pyasn1<0.6.0,>=0.4.6
  Downloading pyasn1-0.5.1-py2.py3-none-any.whl (84 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 84.9/84.9 kB 11.6 MB/s eta 0:00:00
Installing collected packages: websocket-client, python-dateutil, pyasn1, oauthlib, cachetools, rsa, requests-oauthlib, pyasn1-modules, google-auth, kubernetes
Successfully installed cachetools-5.3.3 google-auth-2.28.2 kubernetes-29.0.0 oauthlib-3.2.2 pyasn1-0.5.1 pyasn1-modules-0.3.0 python-dateutil-2.9.0.post0 requests-oauthlib-1.4.0 rsa-4.9 websocket-client-1.7.0
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
--> 54bf99ab8515
STEP 3/4: RUN ansible-galaxy collection install -p /usr/share/ansible/collections community.general kubernetes.core
[WARNING]: Collection redhatinsights.insights does not support Ansible version
2.15.3
Starting galaxy collection install process
Process install dependency map
Starting collection install process
'kubernetes.core:2.4.0' is already installed, skipping.
Downloading https://galaxy.ansible.com/api/v3/plugin/ansible/content/published/collections/artifacts/community-general-8.4.0.tar.gz to /root/.ansible/tmp/ansible-local-1hca2ffr5/tmpjbuirt_o/community-general-8.4.0-lb93h1ir
Installing 'community.general:8.4.0' to '/usr/share/ansible/collections/ansible_collections/community/general'
community.general:8.4.0 was installed successfully
--> 467b37d81a43
STEP 4/4: RUN curl -L https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | VERIFY_CHECKSUM=false bash && helm version
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0100 11679  100 11679    0     0  65910      0 --:--:-- --:--:-- --:--:-- 65983
Downloading https://get.helm.sh/helm-v3.14.3-linux-amd64.tar.gz
Preparing to install helm into /usr/local/bin
helm installed into /usr/local/bin/helm
version.BuildInfo{Version:"v3.14.3", GitCommit:"f03cc04caaa8f6d7c3e67cf918929150cf6f3f12", GitTreeState:"clean", GoVersion:"go1.21.7"}
COMMIT kiali-molecule:latest
--> 905f13d51eb7
Successfully tagged localhost/kiali-molecule:latest
905f13d51eb731489710a7d99e6cb3ea16719a3670f97d98ba55af56e38cceb4
podman volume exists molecule-tests-volume && echo "Podman volume already exists; deleting it" && podman volume rm molecule-tests-volume || true
podman volume create molecule-tests-volume
molecule-tests-volume
podman create -v molecule-tests-volume:/data --name molecule-volume-helper docker.io/busybox true
Trying to pull docker.io/library/busybox:latest...
Getting image source signatures
Copying blob sha256:7b2699543f22d5b8dc8d66a5873eb246767bca37232dee1e7a3b8c9956bceb0c
Copying config sha256:ba5dc23f65d4cc4a4535bce55cf9e63b068eb02946e3422d3587e8ce803b6aab
Writing manifest to image destination
161ca4e1970e3ec4053ac02e36ddec641c37ed062c35268b88da22e5dbc8da6f
podman cp "/home/jmazzite/source/kiali/helm-charts" molecule-volume-helper:/data/helm-charts-repo
podman cp "/home/jmazzite/source/kiali/kiali/operator/" molecule-volume-helper:/data/operator
podman cp "/home/jmazzite/.kube/config" molecule-volume-helper:/data/kubeconfig
podman rm molecule-volume-helper
molecule-volume-helper
for msn in header-auth-test; do podman run --rm  --env KUBECONFIG="/tmp/molecule/kubeconfig" --env K8S_AUTH_KUBECONFIG="/tmp/molecule/kubeconfig" --env MOLECULE_CLUSTER_TYPE="minikube" --env MOLECULE_HELM_CHARTS_REPO=/tmp/molecule/helm-charts-repo -v molecule-tests-volume:/tmp/molecule -v /home/jmazzite/.minikube/certs/ca.pem:/home/jmazzite/.minikube/certs/ca.pem:Z -v /home/jmazzite/.minikube/certs/ca-key.pem:/home/jmazzite/.minikube/certs/ca-key.pem:Z -v /home/jmazzite/.minikube/certs/cert.pem:/home/jmazzite/.minikube/certs/cert.pem:Z -v /home/jmazzite/.minikube/certs/key.pem:/home/jmazzite/.minikube/certs/key.pem:Z -v /home/jmazzite/.minikube/machines/server.pem:/home/jmazzite/.minikube/machines/server.pem:Z -v /home/jmazzite/.minikube/machines/server-key.pem:/home/jmazzite/.minikube/machines/server-key.pem:Z -v /home/jmazzite/.minikube/machines/ci/id_rsa:/home/jmazzite/.minikube/machines/ci/id_rsa:Z -v /home/jmazzite/.minikube/machines/ci/id_rsa.pub:/home/jmazzite/.minikube/machines/ci/id_rsa.pub:Z -v /home/jmazzite/.minikube/machines/ci/config.json:/home/jmazzite/.minikube/machines/ci/config.json:Z -v /home/jmazzite/.minikube/cache/preloaded-tarball/preloaded-images-k8s-v18-v1.27.3-docker-overlay2-amd64.tar.lz4:/home/jmazzite/.minikube/cache/preloaded-tarball/preloaded-images-k8s-v18-v1.27.3-docker-overlay2-amd64.tar.lz4:Z -v /home/jmazzite/.minikube/cache/preloaded-tarball/preloaded-images-k8s-v18-v1.27.3-docker-overlay2-amd64.tar.lz4.checksum:/home/jmazzite/.minikube/cache/preloaded-tarball/preloaded-images-k8s-v18-v1.27.3-docker-overlay2-amd64.tar.lz4.checksum:Z -v /home/jmazzite/.minikube/cache/linux/amd64/v1.27.3/kubectl:/home/jmazzite/.minikube/cache/linux/amd64/v1.27.3/kubectl:Z -v /home/jmazzite/.minikube/config/config.json:/home/jmazzite/.minikube/config/config.json:Z -v /home/jmazzite/.minikube/logs/audit.json:/home/jmazzite/.minikube/logs/audit.json:Z -v /home/jmazzite/.minikube/logs/lastStart.txt:/home/jmazzite/.minikube/logs/lastStart.txt:Z -v /home/jmazzite/.minikube/profiles/ci/events.json:/home/jmazzite/.minikube/profiles/ci/events.json:Z -v /home/jmazzite/.minikube/profiles/ci/client.crt:/home/jmazzite/.minikube/profiles/ci/client.crt:Z -v /home/jmazzite/.minikube/profiles/ci/client.key:/home/jmazzite/.minikube/profiles/ci/client.key:Z -v /home/jmazzite/.minikube/profiles/ci/apiserver.crt.a014e791:/home/jmazzite/.minikube/profiles/ci/apiserver.crt.a014e791:Z -v /home/jmazzite/.minikube/profiles/ci/apiserver.key.a014e791:/home/jmazzite/.minikube/profiles/ci/apiserver.key.a014e791:Z -v /home/jmazzite/.minikube/profiles/ci/apiserver.crt:/home/jmazzite/.minikube/profiles/ci/apiserver.crt:Z -v /home/jmazzite/.minikube/profiles/ci/apiserver.key:/home/jmazzite/.minikube/profiles/ci/apiserver.key:Z -v /home/jmazzite/.minikube/profiles/ci/proxy-client.crt:/home/jmazzite/.minikube/profiles/ci/proxy-client.crt:Z -v /home/jmazzite/.minikube/profiles/ci/proxy-client.key:/home/jmazzite/.minikube/profiles/ci/proxy-client.key:Z -v /home/jmazzite/.minikube/profiles/ci/config.json:/home/jmazzite/.minikube/profiles/ci/config.json:Z -v /home/jmazzite/.minikube/last_update_check:/home/jmazzite/.minikube/last_update_check:Z -v /home/jmazzite/.minikube/bin/docker-machine-driver-kvm2:/home/jmazzite/.minikube/bin/docker-machine-driver-kvm2:Z -v /home/jmazzite/.minikube/ca.crt:/home/jmazzite/.minikube/ca.crt:Z -v /home/jmazzite/.minikube/ca.key:/home/jmazzite/.minikube/ca.key:Z -v /home/jmazzite/.minikube/proxy-client-ca.crt:/home/jmazzite/.minikube/proxy-client-ca.crt:Z -v /home/jmazzite/.minikube/proxy-client-ca.key:/home/jmazzite/.minikube/proxy-client-ca.key:Z -v /home/jmazzite/.minikube/ca.pem:/home/jmazzite/.minikube/ca.pem:Z -v /home/jmazzite/.minikube/cert.pem:/home/jmazzite/.minikube/cert.pem:Z -v /home/jmazzite/.minikube/key.pem:/home/jmazzite/.minikube/key.pem:Z --env MOLECULE_MINIKUBE_IP=192.168.39.60  -w /tmp/molecule/operator --network="host"  --add-host="api.crc.testing:192.168.130.11" --add-host="kiali-istio-system.apps-crc.testing:192.168.130.11" --add-host="prometheus-istio-system.apps-crc.testing:192.168.130.11" --env DORP=podman --env OPERATOR_IMAGE_PULL_SECRET_NAME= --env MOLECULE_KIALI_CR_SPEC_VERSION=default --env PLUGIN_IMAGE_PULL_SECRET_JSON="" --env MOLECULE_OSSMCONSOLE_CR_SPEC_VERSION="default"  --env MOLECULE_OPERATOR_PROFILER_ENABLED=true --env MOLECULE_OPERATOR_INSTALLER=skip --env MOLECULE_DUMP_LOGS_ON_ERROR=true  --env MOLECULE_WAIT_RETRIES=120 localhost/kiali-molecule:latest molecule --debug test  --scenario-name ${msn}; if [ "$?" != "0" ]; then echo "Molecule test failed: ${msn}"; podman volume rm molecule-tests-volume; exit 1; fi; done
DEBUG    Validating schema /tmp/molecule/operator/molecule/header-auth-test/molecule.yml.
WARNING  Driver podman does not provide a schema.
INFO     header-auth-test scenario test matrix: prepare, converge, destroy
INFO     Performing prerun with role_name_check=0...
INFO     Running ansible-galaxy collection install -v -r requirements.yml
INFO     Set ANSIBLE_ROLES_PATH=roles:/home/runner/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles
INFO     Running header-auth-test > prepare
INFO     Sanity checks: 'podman'
DEBUG: ANSIBLE ENVIRONMENT:
ANSIBLE_COLLECTIONS_PATH: /home/runner/.cache/molecule/operator/header-auth-test/collections:/home/runner/.ansible/collections:/usr/share/ansible/collections:/etc/ansible/collections
ANSIBLE_CONFIG: /home/runner/.cache/molecule/operator/header-auth-test/ansible.cfg
ANSIBLE_FILTER_PLUGINS: /usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/filter:/home/runner/.cache/molecule/operator/header-auth-test/plugins/filter:/tmp/molecule/operator/plugins/filter:/home/runner/.ansible/plugins/filter:/usr/share/ansible/plugins/filter
ANSIBLE_LIBRARY: /usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/modules:/usr/local/lib/python3.11/site-packages/molecule_plugins/vagrant/modules:/home/runner/.cache/molecule/operator/header-auth-test/library:/tmp/molecule/operator/library:/home/runner/.ansible/plugins/modules:/usr/share/ansible/plugins/modules
ANSIBLE_ROLES_PATH: /home/runner/.cache/molecule/operator/header-auth-test/roles:/tmp/molecule:/home/runner/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles

DEBUG: MOLECULE ENVIRONMENT:
MOLECULE_CLUSTER_TYPE: minikube
MOLECULE_DEBUG: 'True'
MOLECULE_DEPENDENCY_NAME: galaxy
MOLECULE_DRIVER_NAME: podman
MOLECULE_DUMP_LOGS_ON_ERROR: 'true'
MOLECULE_ENV_FILE: /tmp/molecule/operator/.env.yml
MOLECULE_EPHEMERAL_DIRECTORY: /home/runner/.cache/molecule/operator/header-auth-test
MOLECULE_FILE: /home/runner/.cache/molecule/operator/header-auth-test/molecule.yml
MOLECULE_HELM_CHARTS_REPO: /tmp/molecule/helm-charts-repo
MOLECULE_INSTANCE_CONFIG: /home/runner/.cache/molecule/operator/header-auth-test/instance_config.yml
MOLECULE_INVENTORY_FILE: /home/runner/.cache/molecule/operator/header-auth-test/inventory/ansible_inventory.yml
MOLECULE_KIALI_CR_SPEC_VERSION: default
MOLECULE_MINIKUBE_IP: 192.168.39.60
MOLECULE_OPERATOR_INSTALLER: skip
MOLECULE_OPERATOR_PROFILER_ENABLED: 'true'
MOLECULE_OSSMCONSOLE_CR_SPEC_VERSION: default
MOLECULE_PROJECT_DIRECTORY: /tmp/molecule/operator
MOLECULE_PROVISIONER_NAME: ansible
MOLECULE_SCENARIO_DIRECTORY: /tmp/molecule/operator/molecule/header-auth-test
MOLECULE_SCENARIO_NAME: header-auth-test
MOLECULE_STATE_FILE: /home/runner/.cache/molecule/operator/header-auth-test/state.yml
MOLECULE_VERIFIER_NAME: ansible
MOLECULE_VERIFIER_TEST_DIRECTORY: /tmp/molecule/operator/molecule/header-auth-test/tests
MOLECULE_WAIT_RETRIES: '120'

DEBUG: SHELL REPLAY:
ANSIBLE_COLLECTIONS_PATH=/home/runner/.cache/molecule/operator/header-auth-test/collections:/home/runner/.ansible/collections:/usr/share/ansible/collections:/etc/ansible/collections ANSIBLE_CONFIG=/home/runner/.cache/molecule/operator/header-auth-test/ansible.cfg ANSIBLE_FILTER_PLUGINS=/usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/filter:/home/runner/.cache/molecule/operator/header-auth-test/plugins/filter:/tmp/molecule/operator/plugins/filter:/home/runner/.ansible/plugins/filter:/usr/share/ansible/plugins/filter ANSIBLE_LIBRARY=/usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/modules:/usr/local/lib/python3.11/site-packages/molecule_plugins/vagrant/modules:/home/runner/.cache/molecule/operator/header-auth-test/library:/tmp/molecule/operator/library:/home/runner/.ansible/plugins/modules:/usr/share/ansible/plugins/modules ANSIBLE_ROLES_PATH=/home/runner/.cache/molecule/operator/header-auth-test/roles:/tmp/molecule:/home/runner/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles MOLECULE_CLUSTER_TYPE=minikube MOLECULE_DEBUG=True MOLECULE_DEPENDENCY_NAME=galaxy MOLECULE_DRIVER_NAME=podman MOLECULE_DUMP_LOGS_ON_ERROR=true MOLECULE_ENV_FILE=/tmp/molecule/operator/.env.yml MOLECULE_EPHEMERAL_DIRECTORY=/home/runner/.cache/molecule/operator/header-auth-test MOLECULE_FILE=/home/runner/.cache/molecule/operator/header-auth-test/molecule.yml MOLECULE_HELM_CHARTS_REPO=/tmp/molecule/helm-charts-repo MOLECULE_INSTANCE_CONFIG=/home/runner/.cache/molecule/operator/header-auth-test/instance_config.yml MOLECULE_INVENTORY_FILE=/home/runner/.cache/molecule/operator/header-auth-test/inventory/ansible_inventory.yml MOLECULE_KIALI_CR_SPEC_VERSION=default MOLECULE_MINIKUBE_IP=192.168.39.60 MOLECULE_OPERATOR_INSTALLER=skip MOLECULE_OPERATOR_PROFILER_ENABLED=true MOLECULE_OSSMCONSOLE_CR_SPEC_VERSION=default MOLECULE_PROJECT_DIRECTORY=/tmp/molecule/operator MOLECULE_PROVISIONER_NAME=ansible MOLECULE_SCENARIO_DIRECTORY=/tmp/molecule/operator/molecule/header-auth-test MOLECULE_SCENARIO_NAME=header-auth-test MOLECULE_STATE_FILE=/home/runner/.cache/molecule/operator/header-auth-test/state.yml MOLECULE_VERIFIER_NAME=ansible MOLECULE_VERIFIER_TEST_DIRECTORY=/tmp/molecule/operator/molecule/header-auth-test/tests MOLECULE_WAIT_RETRIES=120


PLAY [Prepare] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Get information about the cluster] ***************************************
ok: [localhost]

TASK [Determine the cluster type] **********************************************
ok: [localhost]

TASK [Determine if the operator installation is managed externally or not] *****
ok: [localhost]

TASK [Make sure the operator namespace exists] *********************************
ok: [localhost]

TASK [Find the latest Operator Helm Chart] *************************************
skipping: [localhost]

TASK [set_fact] ****************************************************************
skipping: [localhost]

TASK [fail] ********************************************************************
skipping: [localhost]

TASK [Install Operator via Helm] ***********************************************
skipping: [localhost]

TASK [Make sure the CR namespace exists] ***************************************
ok: [localhost]

TASK [Wait for the CRD to be established] **************************************
ok: [localhost]

TASK [Prepare initial Kiali CR definition based solely on the template] ********
ok: [localhost]

TASK [Create Kiali CR] *********************************************************
changed: [localhost]

TASK [Asserting that Kiali is Deployed] ****************************************
FAILED - RETRYING: [localhost]: Asserting that Kiali is Deployed (120 retries left).
FAILED - RETRYING: [localhost]: Asserting that Kiali is Deployed (119 retries left).
FAILED - RETRYING: [localhost]: Asserting that Kiali is Deployed (118 retries left).
FAILED - RETRYING: [localhost]: Asserting that Kiali is Deployed (117 retries left).
FAILED - RETRYING: [localhost]: Asserting that Kiali is Deployed (116 retries left).
FAILED - RETRYING: [localhost]: Asserting that Kiali is Deployed (115 retries left).
FAILED - RETRYING: [localhost]: Asserting that Kiali is Deployed (114 retries left).
ok: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=10   changed=1    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0

INFO     Running header-auth-test > converge
DEBUG: ANSIBLE ENVIRONMENT:
ANSIBLE_COLLECTIONS_PATH: /home/runner/.cache/molecule/operator/header-auth-test/collections:/home/runner/.ansible/collections:/usr/share/ansible/collections:/etc/ansible/collections
ANSIBLE_CONFIG: /home/runner/.cache/molecule/operator/header-auth-test/ansible.cfg
ANSIBLE_FILTER_PLUGINS: /usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/filter:/home/runner/.cache/molecule/operator/header-auth-test/plugins/filter:/tmp/molecule/operator/plugins/filter:/home/runner/.ansible/plugins/filter:/usr/share/ansible/plugins/filter
ANSIBLE_LIBRARY: /usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/modules:/usr/local/lib/python3.11/site-packages/molecule_plugins/vagrant/modules:/home/runner/.cache/molecule/operator/header-auth-test/library:/tmp/molecule/operator/library:/home/runner/.ansible/plugins/modules:/usr/share/ansible/plugins/modules
ANSIBLE_ROLES_PATH: /home/runner/.cache/molecule/operator/header-auth-test/roles:/tmp/molecule:/home/runner/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles

DEBUG: MOLECULE ENVIRONMENT:
MOLECULE_CLUSTER_TYPE: minikube
MOLECULE_DEBUG: 'True'
MOLECULE_DEPENDENCY_NAME: galaxy
MOLECULE_DRIVER_NAME: podman
MOLECULE_DUMP_LOGS_ON_ERROR: 'true'
MOLECULE_ENV_FILE: /tmp/molecule/operator/.env.yml
MOLECULE_EPHEMERAL_DIRECTORY: /home/runner/.cache/molecule/operator/header-auth-test
MOLECULE_FILE: /home/runner/.cache/molecule/operator/header-auth-test/molecule.yml
MOLECULE_HELM_CHARTS_REPO: /tmp/molecule/helm-charts-repo
MOLECULE_INSTANCE_CONFIG: /home/runner/.cache/molecule/operator/header-auth-test/instance_config.yml
MOLECULE_INVENTORY_FILE: /home/runner/.cache/molecule/operator/header-auth-test/inventory/ansible_inventory.yml
MOLECULE_KIALI_CR_SPEC_VERSION: default
MOLECULE_MINIKUBE_IP: 192.168.39.60
MOLECULE_OPERATOR_INSTALLER: skip
MOLECULE_OPERATOR_PROFILER_ENABLED: 'true'
MOLECULE_OSSMCONSOLE_CR_SPEC_VERSION: default
MOLECULE_PROJECT_DIRECTORY: /tmp/molecule/operator
MOLECULE_PROVISIONER_NAME: ansible
MOLECULE_SCENARIO_DIRECTORY: /tmp/molecule/operator/molecule/header-auth-test
MOLECULE_SCENARIO_NAME: header-auth-test
MOLECULE_STATE_FILE: /home/runner/.cache/molecule/operator/header-auth-test/state.yml
MOLECULE_VERIFIER_NAME: ansible
MOLECULE_VERIFIER_TEST_DIRECTORY: /tmp/molecule/operator/molecule/header-auth-test/tests
MOLECULE_WAIT_RETRIES: '120'

DEBUG: SHELL REPLAY:
ANSIBLE_COLLECTIONS_PATH=/home/runner/.cache/molecule/operator/header-auth-test/collections:/home/runner/.ansible/collections:/usr/share/ansible/collections:/etc/ansible/collections ANSIBLE_CONFIG=/home/runner/.cache/molecule/operator/header-auth-test/ansible.cfg ANSIBLE_FILTER_PLUGINS=/usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/filter:/home/runner/.cache/molecule/operator/header-auth-test/plugins/filter:/tmp/molecule/operator/plugins/filter:/home/runner/.ansible/plugins/filter:/usr/share/ansible/plugins/filter ANSIBLE_LIBRARY=/usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/modules:/usr/local/lib/python3.11/site-packages/molecule_plugins/vagrant/modules:/home/runner/.cache/molecule/operator/header-auth-test/library:/tmp/molecule/operator/library:/home/runner/.ansible/plugins/modules:/usr/share/ansible/plugins/modules ANSIBLE_ROLES_PATH=/home/runner/.cache/molecule/operator/header-auth-test/roles:/tmp/molecule:/home/runner/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles MOLECULE_CLUSTER_TYPE=minikube MOLECULE_DEBUG=True MOLECULE_DEPENDENCY_NAME=galaxy MOLECULE_DRIVER_NAME=podman MOLECULE_DUMP_LOGS_ON_ERROR=true MOLECULE_ENV_FILE=/tmp/molecule/operator/.env.yml MOLECULE_EPHEMERAL_DIRECTORY=/home/runner/.cache/molecule/operator/header-auth-test MOLECULE_FILE=/home/runner/.cache/molecule/operator/header-auth-test/molecule.yml MOLECULE_HELM_CHARTS_REPO=/tmp/molecule/helm-charts-repo MOLECULE_INSTANCE_CONFIG=/home/runner/.cache/molecule/operator/header-auth-test/instance_config.yml MOLECULE_INVENTORY_FILE=/home/runner/.cache/molecule/operator/header-auth-test/inventory/ansible_inventory.yml MOLECULE_KIALI_CR_SPEC_VERSION=default MOLECULE_MINIKUBE_IP=192.168.39.60 MOLECULE_OPERATOR_INSTALLER=skip MOLECULE_OPERATOR_PROFILER_ENABLED=true MOLECULE_OSSMCONSOLE_CR_SPEC_VERSION=default MOLECULE_PROJECT_DIRECTORY=/tmp/molecule/operator MOLECULE_PROVISIONER_NAME=ansible MOLECULE_SCENARIO_DIRECTORY=/tmp/molecule/operator/molecule/header-auth-test MOLECULE_SCENARIO_NAME=header-auth-test MOLECULE_STATE_FILE=/home/runner/.cache/molecule/operator/header-auth-test/state.yml MOLECULE_VERIFIER_NAME=ansible MOLECULE_VERIFIER_TEST_DIRECTORY=/tmp/molecule/operator/molecule/header-auth-test/tests MOLECULE_WAIT_RETRIES=120


PLAY [Tests] *******************************************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Get information about the cluster] ***************************************
ok: [localhost]

TASK [Determine the cluster type] **********************************************
ok: [localhost]

TASK [Get Kiali CR if present] *************************************************
ok: [localhost]

TASK [Get Kiali Operator Pod] **************************************************
ok: [localhost]

TASK [Get Kiali Pod] ***********************************************************
ok: [localhost]

TASK [Get Kiali Configmap] *****************************************************
ok: [localhost]

TASK [Format Configmap] ********************************************************
ok: [localhost]

TASK [Get Kiali Deployment] ****************************************************
ok: [localhost]

TASK [Get Kiali Service] *******************************************************
ok: [localhost]

TASK [Get Kiali Route] *********************************************************
skipping: [localhost]

TASK [Get Kiali Ingress] *******************************************************
ok: [localhost]

TASK [Determine the Kiali Route URL on OpenShift] ******************************
skipping: [localhost]

TASK [Determine the Kiali Ingress URL on minikube] *****************************
ok: [localhost]

TASK [Determine the Kiali Ingress URL on kind] *********************************
skipping: [localhost]

TASK [Assert Kiali Pod is Running and there is only one] ***********************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Assert Kiali Pod is Running on the correct Namespace] ********************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Asserting that Kiali Pod exists and there is only one] *******************
ok: [localhost]

TASK [Wait for Kiali to be running and accepting requests] *********************
ok: [localhost]

TASK [Make sure the test set the strategy to header] ***************************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Assert that we can access Kiali console login screen that does not need authentication] ***
ok: [localhost]

TASK [Try to access Kiali api endpoint that requires authentication (should return error - we did not login yet)] ***
ok: [localhost]

TASK [Step one - start] ********************************************************
ok: [localhost]

TASK [Assert step one] *********************************************************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [set_fact] ****************************************************************
ok: [localhost]

TASK [Step two - auth request] *************************************************
ok: [localhost]

TASK [Assert step two] *********************************************************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Step three - auth local request (strip some weirdness in the location URL)] ***
ok: [localhost]

TASK [Assert step three] *******************************************************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Step four - local login (strip some weirdness in the location URL)] ******
ok: [localhost]

TASK [Assert step four] ********************************************************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Step five - approval (strip some weirdness in the location URL)] *********
ok: [localhost]

TASK [Assert step five] ********************************************************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Step six - callback (strip some weirdness off the location - why is ansible doing that?)] ***
ok: [localhost]

TASK [Assert step six] *********************************************************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [set_fact] ****************************************************************
ok: [localhost]

TASK [Step seven - get bearer token] *******************************************
ok: [localhost]

TASK [Assert step seven] *******************************************************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [set_fact] ****************************************************************
ok: [localhost]

TASK [Make a request that requires authentication (should now return 200)] *****
ok: [localhost]

TASK [Assert that we were able to get the list of namespaces] ******************
ok: [localhost] => {
    "changed": false,
    "msg": "All assertions passed"
}

PLAY RECAP *********************************************************************
localhost                  : ok=38   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0

INFO     Running header-auth-test > destroy
DEBUG: ANSIBLE ENVIRONMENT:
ANSIBLE_COLLECTIONS_PATH: /home/runner/.cache/molecule/operator/header-auth-test/collections:/home/runner/.ansible/collections:/usr/share/ansible/collections:/etc/ansible/collections
ANSIBLE_CONFIG: /home/runner/.cache/molecule/operator/header-auth-test/ansible.cfg
ANSIBLE_FILTER_PLUGINS: /usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/filter:/home/runner/.cache/molecule/operator/header-auth-test/plugins/filter:/tmp/molecule/operator/plugins/filter:/home/runner/.ansible/plugins/filter:/usr/share/ansible/plugins/filter
ANSIBLE_LIBRARY: /usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/modules:/usr/local/lib/python3.11/site-packages/molecule_plugins/vagrant/modules:/home/runner/.cache/molecule/operator/header-auth-test/library:/tmp/molecule/operator/library:/home/runner/.ansible/plugins/modules:/usr/share/ansible/plugins/modules
ANSIBLE_ROLES_PATH: /home/runner/.cache/molecule/operator/header-auth-test/roles:/tmp/molecule:/home/runner/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles

DEBUG: MOLECULE ENVIRONMENT:
MOLECULE_CLUSTER_TYPE: minikube
MOLECULE_DEBUG: 'True'
MOLECULE_DEPENDENCY_NAME: galaxy
MOLECULE_DRIVER_NAME: podman
MOLECULE_DUMP_LOGS_ON_ERROR: 'true'
MOLECULE_ENV_FILE: /tmp/molecule/operator/.env.yml
MOLECULE_EPHEMERAL_DIRECTORY: /home/runner/.cache/molecule/operator/header-auth-test
MOLECULE_FILE: /home/runner/.cache/molecule/operator/header-auth-test/molecule.yml
MOLECULE_HELM_CHARTS_REPO: /tmp/molecule/helm-charts-repo
MOLECULE_INSTANCE_CONFIG: /home/runner/.cache/molecule/operator/header-auth-test/instance_config.yml
MOLECULE_INVENTORY_FILE: /home/runner/.cache/molecule/operator/header-auth-test/inventory/ansible_inventory.yml
MOLECULE_KIALI_CR_SPEC_VERSION: default
MOLECULE_MINIKUBE_IP: 192.168.39.60
MOLECULE_OPERATOR_INSTALLER: skip
MOLECULE_OPERATOR_PROFILER_ENABLED: 'true'
MOLECULE_OSSMCONSOLE_CR_SPEC_VERSION: default
MOLECULE_PROJECT_DIRECTORY: /tmp/molecule/operator
MOLECULE_PROVISIONER_NAME: ansible
MOLECULE_SCENARIO_DIRECTORY: /tmp/molecule/operator/molecule/header-auth-test
MOLECULE_SCENARIO_NAME: header-auth-test
MOLECULE_STATE_FILE: /home/runner/.cache/molecule/operator/header-auth-test/state.yml
MOLECULE_VERIFIER_NAME: ansible
MOLECULE_VERIFIER_TEST_DIRECTORY: /tmp/molecule/operator/molecule/header-auth-test/tests
MOLECULE_WAIT_RETRIES: '120'

DEBUG: SHELL REPLAY:
ANSIBLE_COLLECTIONS_PATH=/home/runner/.cache/molecule/operator/header-auth-test/collections:/home/runner/.ansible/collections:/usr/share/ansible/collections:/etc/ansible/collections ANSIBLE_CONFIG=/home/runner/.cache/molecule/operator/header-auth-test/ansible.cfg ANSIBLE_FILTER_PLUGINS=/usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/filter:/home/runner/.cache/molecule/operator/header-auth-test/plugins/filter:/tmp/molecule/operator/plugins/filter:/home/runner/.ansible/plugins/filter:/usr/share/ansible/plugins/filter ANSIBLE_LIBRARY=/usr/local/lib/python3.11/site-packages/molecule/provisioner/ansible/plugins/modules:/usr/local/lib/python3.11/site-packages/molecule_plugins/vagrant/modules:/home/runner/.cache/molecule/operator/header-auth-test/library:/tmp/molecule/operator/library:/home/runner/.ansible/plugins/modules:/usr/share/ansible/plugins/modules ANSIBLE_ROLES_PATH=/home/runner/.cache/molecule/operator/header-auth-test/roles:/tmp/molecule:/home/runner/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles MOLECULE_CLUSTER_TYPE=minikube MOLECULE_DEBUG=True MOLECULE_DEPENDENCY_NAME=galaxy MOLECULE_DRIVER_NAME=podman MOLECULE_DUMP_LOGS_ON_ERROR=true MOLECULE_ENV_FILE=/tmp/molecule/operator/.env.yml MOLECULE_EPHEMERAL_DIRECTORY=/home/runner/.cache/molecule/operator/header-auth-test MOLECULE_FILE=/home/runner/.cache/molecule/operator/header-auth-test/molecule.yml MOLECULE_HELM_CHARTS_REPO=/tmp/molecule/helm-charts-repo MOLECULE_INSTANCE_CONFIG=/home/runner/.cache/molecule/operator/header-auth-test/instance_config.yml MOLECULE_INVENTORY_FILE=/home/runner/.cache/molecule/operator/header-auth-test/inventory/ansible_inventory.yml MOLECULE_KIALI_CR_SPEC_VERSION=default MOLECULE_MINIKUBE_IP=192.168.39.60 MOLECULE_OPERATOR_INSTALLER=skip MOLECULE_OPERATOR_PROFILER_ENABLED=true MOLECULE_OSSMCONSOLE_CR_SPEC_VERSION=default MOLECULE_PROJECT_DIRECTORY=/tmp/molecule/operator MOLECULE_PROVISIONER_NAME=ansible MOLECULE_SCENARIO_DIRECTORY=/tmp/molecule/operator/molecule/header-auth-test MOLECULE_SCENARIO_NAME=header-auth-test MOLECULE_STATE_FILE=/home/runner/.cache/molecule/operator/header-auth-test/state.yml MOLECULE_VERIFIER_NAME=ansible MOLECULE_VERIFIER_TEST_DIRECTORY=/tmp/molecule/operator/molecule/header-auth-test/tests MOLECULE_WAIT_RETRIES=120


PLAY [Destroy] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Get information about the cluster] ***************************************
ok: [localhost]

TASK [Determine the cluster type] **********************************************
ok: [localhost]

TASK [Determine if the operator installation is managed externally or not] *****
ok: [localhost]

TASK [Remove Kiali CR] *********************************************************
changed: [localhost]

TASK [Wait for Kiali ConfigMap to be uninstalled] ******************************
ok: [localhost]

TASK [Uninstall Operator via Helm] *********************************************
skipping: [localhost]

TASK [Remove CRDs] *************************************************************
skipping: [localhost]

TASK [Removing Operator namespace] *********************************************
skipping: [localhost]

TASK [Removing CR namespace if it is different than control plane and operator namespace] ***
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=6    changed=1    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0

INFO     Pruning extra files from scenario ephemeral directory
podman volume rm molecule-tests-volume
molecule-tests-volume
rolebinding.rbac.authorization.k8s.io "openid-rolebinding-istio-system" deleted
